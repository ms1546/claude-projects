#!/bin/bash
# ç°¡æ˜“PRä½œæˆã‚³ãƒãƒ³ãƒ‰

# ç¾åœ¨ã®ãƒ–ãƒ©ãƒ³ãƒæƒ…å ±ã‚’å–å¾—
CURRENT_BRANCH=$(git branch --show-current)
COMMIT_COUNT=$(git rev-list --count HEAD ^origin/main 2>/dev/null || echo "0")

# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®PRã‚¿ã‚¤ãƒˆãƒ«ã‚’ç”Ÿæˆ
DEFAULT_TITLE="$CURRENT_BRANCH"

echo "ğŸ”„ ç¾åœ¨ã®ãƒ–ãƒ©ãƒ³ãƒ: $CURRENT_BRANCH"
echo "ğŸ“Š mainã‹ã‚‰ã®ã‚³ãƒŸãƒƒãƒˆæ•°: $COMMIT_COUNT"

# å¤‰æ›´ãŒã‚ã‚‹å ´åˆã¯ã‚³ãƒŸãƒƒãƒˆ
if ! git diff --quiet || ! git diff --cached --quiet; then
    echo "ğŸ“ æœªã‚³ãƒŸãƒƒãƒˆã®å¤‰æ›´ã‚’æ¤œå‡ºã—ã¾ã—ãŸ"
    git status --short
    echo ""
    echo "ã“ã‚Œã‚‰ã®å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ (y/n)"
    read -r response
    if [[ "$response" =~ ^[Yy]$ ]]; then
        git add -A
        echo "ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (ç©ºã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ):"
        read -r commit_msg
        if [ -z "$commit_msg" ]; then
            commit_msg="Update: $CURRENT_BRANCH"
        fi
        git commit -m "$commit_msg

ğŸ¤– Generated with Claude Code

Co-Authored-By: Claude <noreply@anthropic.com>"
    fi
fi

# ãƒ—ãƒƒã‚·ãƒ¥
echo "ğŸš€ ãƒªãƒ¢ãƒ¼ãƒˆã«ãƒ—ãƒƒã‚·ãƒ¥ä¸­..."
git push -u origin "$CURRENT_BRANCH"

# PRä½œæˆ
echo "ğŸ¯ PRä½œæˆä¸­..."
gh pr create --fill --base main

echo "âœ… å®Œäº†ï¼"