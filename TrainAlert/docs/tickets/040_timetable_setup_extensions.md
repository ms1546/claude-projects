# Ticket #040: 時刻表設定での拡張機能（駅数・繰り返し設定）

## 概要
「時刻表から設定」での設定方法に、「経路から設定」と同様の機能（駅数で設定、繰り返し設定など）を追加する。現在は経路検索ベースのみに実装されている機能を時刻表ベースでも利用可能にする。

## 優先度: Medium
## 見積もり: 12h
## ステータス: [ ] Not Started / [ ] In Progress / [ ] Completed

## 現状と要望
- 現在：時刻表設定では基本的な通知時間設定のみ可能
- 要望：経路検索と同等の高度な設定機能を追加
  - 駅数ベースの通知設定
  - 繰り返し設定（毎日/平日/週末/カスタム）
  - スヌーズ設定への対応準備

## タスク
### UI統合
- [ ] TimetableAlertSetupViewの拡張
  - [ ] 通知方法選択UI（時間/駅数）
  - [ ] 駅数選択UI（1〜10駅前）
  - [ ] 停車駅プレビュー表示
- [ ] 繰り返し設定UIの統合
  - [ ] 既存のRepeatPatternコンポーネント活用
  - [ ] 時刻表特有の制約対応
  - [ ] 次回通知予定の表示
- [ ] 設定内容のサマリー表示
  - [ ] 選択した設定の一覧表示
  - [ ] 変更可能な編集UI

### データモデル拡張
- [ ] TimetableAlertエンティティの拡張
  - [ ] notificationStationsBeforeフィールド追加
  - [ ] isRepeatingフィールド追加
  - [ ] repeatPatternフィールド追加
  - [ ] repeatDaysフィールド追加
- [ ] マイグレーション対応
  - [ ] 既存データの移行
  - [ ] デフォルト値の設定

### ビジネスロジック統合
- [ ] StationCountCalculatorの活用
  - [ ] 時刻表データからの停車駅取得
  - [ ] 通知駅の計算ロジック適用
  - [ ] 時刻表特有のエラーハンドリング
- [ ] 繰り返し通知スケジューラーの統合
  - [ ] 時刻表ベースでの繰り返し設定
  - [ ] 既存のNotificationManager拡張
  - [ ] 時刻表更新時の再スケジュール

### 互換性とバリデーション
- [ ] 機能の相互運用性確保
  - [ ] 駅数設定と繰り返し設定の組み合わせ
  - [ ] ハイブリッド通知との連携
  - [ ] 既存アラートへの影響確認
- [ ] エラーハンドリング
  - [ ] 時刻表データ不足時の対応
  - [ ] 停車駅情報がない場合の処理

## 実装ガイドライン
- 既存の経路検索ベースの実装を最大限活用
- UIの一貫性を保ちながら時刻表特有の要件に対応
- パフォーマンスを考慮した実装

## 完了条件（Definition of Done）
- [ ] 時刻表設定で駅数ベースの通知が設定できる
- [ ] 時刻表設定で繰り返し設定ができる
- [ ] 設定内容がプレビューで確認できる
- [ ] 既存の経路検索設定と同等の機能が利用可能

## テスト方法
1. 時刻表から電車を選択
2. 駅数ベースの通知を設定
3. 繰り返し設定を追加
4. プレビューで設定内容を確認
5. 実際の通知動作を検証

## 依存関係
- チケット#023（駅数ベース通知機能）- 完了済み
- チケット#024（繰り返し設定機能）- 完了済み

## 成果物
- TimetableAlertSetupView.swift（拡張版）
- TimetableAlert+Extensions.swift
- 統合されたUI/UXコンポーネント
- テストケース

## 備考
- ユーザビリティの向上に大きく貢献
- 経路検索と時刻表の機能格差を解消
- 将来的にはさらなる高度な設定も検討
