# Ticket #031: 路線検索の拡充と乗り換え機能強化

## 概要
現在限定的な路線（ODPT対応路線のみ）から、より多くの路線での経路検索を可能にし、乗り換え駅での目覚まし設定も含めた本格的な乗り換え対応を実装する。

## 優先度: High
## 見積もり: 24h
## ステータス: [ ] Not Started / [ ] In Progress / [ ] Completed

## タスク
### API拡張
- [ ] 追加APIの調査・選定
  - [ ] Yahoo!乗換案内API調査
  - [ ] NAVITIME API調査
  - [ ] 駅すぱあとAPI調査
  - [ ] コスト/制限の比較
- [ ] マルチAPI対応設計
  - [ ] APIアダプターパターン実装
  - [ ] フォールバック機構
  - [ ] レスポンス統一化

### データモデル拡張
- [ ] 複数路線対応
  - [ ] 私鉄各社のデータ構造
  - [ ] バス路線の考慮
  - [ ] 新幹線対応（将来）
- [ ] 乗り換え情報の詳細化
  - [ ] 乗り換え時間の保存
  - [ ] ホーム番号情報
  - [ ] 乗り換え距離/階段情報

### 乗り換え機能実装
- [ ] 複数区間の目覚まし設定
  - [ ] 各区間での個別設定
  - [ ] 乗り換え駅での特別通知
  - [ ] 全体経路の管理
- [ ] 乗り換え駅通知
  - [ ] 「まもなく○○駅で乗り換えです」
  - [ ] 次の電車の発車時刻表示
  - [ ] 乗り換えホーム案内
  - [ ] 乗り遅れ防止アラート

### UI実装
- [ ] 経路検索結果の拡張表示
  - [ ] 複数経路の比較表示
  - [ ] 料金情報の表示
  - [ ] 所要時間の詳細
  - [ ] 乗り換え回数の明示
- [ ] 乗り換え設定UI
  - [ ] 区間ごとの通知設定
  - [ ] 乗り換え時間の調整
  - [ ] 視覚的な経路表示

### 最適化
- [ ] キャッシュ戦略
  - [ ] 路線データのローカル保存
  - [ ] よく使う経路のキャッシュ
  - [ ] オフライン対応の検討
- [ ] パフォーマンス改善
  - [ ] 非同期検索の最適化
  - [ ] 結果の段階的表示

## 実装ガイドライン
- 既存のODPT APIとの共存
- APIキーの安全な管理
- レート制限への対応
- エラー時の優雅な劣化

## 完了条件（Definition of Done）
- [ ] JR全線で経路検索ができる
- [ ] 主要私鉄で経路検索ができる
- [ ] 乗り換え駅で適切な通知が出る
- [ ] 複数経路から最適なものを選択できる

## テスト方法
1. 各路線での経路検索
2. 複数乗り換えルートの設定
3. 乗り換え通知のタイミング確認
4. API障害時の動作確認

## 依存関係
- チケット#026（乗り換え対応機能）※拡張として実装
- チケット#018（時刻表統合）

## 成果物
- RouteSearchAPIAdapter.swift
- MultiAPIClient.swift
- ExtendedRouteSearch.swift
- TransferAlertManager.swift
- RouteComparisonView.swift

## 備考
- API利用料金の予算確保が必要
- 段階的なリリースを検討
- 将来的には海外路線も視野に

## 関連する既存チケット
- **#026（乗り換え対応機能）**: 基本的な乗り換え機能は既にチケット化されているため、本チケットはその拡張版として位置付け
