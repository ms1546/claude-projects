# Ticket #023: 駅数ベース通知機能

## 概要
到着駅の○駅前で通知する機能を実装する。

## 優先度: Medium
## 見積もり: 12h
## ステータス: [ ] Not Started / [ ] In Progress / [ ] Completed

## タスク
### API実装
- [ ] TrainTimetable APIクライアント実装
  - [ ] エンドポイント定義
  - [ ] 列車番号による時刻表取得
  - [ ] エラーハンドリング
- [ ] 停車駅リスト取得機能
  - [ ] APIレスポンス解析
  - [ ] 停車駅データモデル
  - [ ] 種別による停車駅フィルタリング

### ビジネスロジック
- [ ] 駅数カウントロジック
  - [ ] 快速・特快等の通過駅除外
  - [ ] 停車駅のみカウント
  - [ ] 逆算アルゴリズム実装
- [ ] 通知駅特定ロジック
  - [ ] 到着駅からの逆算
  - [ ] 通知タイミング計算
  - [ ] 予定時刻の取得

### UI実装
- [ ] 通知タイミング選択UI
  - [ ] 時間/駅数切り替えトグル
  - [ ] 駅数選択（1〜10駅）
  - [ ] 選択値の保存
- [ ] 通知駅プレビューUI
  - [ ] 停車駅リスト表示
  - [ ] 通知駅のハイライト
  - [ ] 到着予定時刻表示
- [ ] 駅リストのビジュアル表示
  - [ ] 路線図風UI
  - [ ] 停車駅マーカー
  - [ ] 現在位置表示

### データ層実装
- [ ] Core Dataモデル拡張
  - [ ] 駅数ベース設定の保存
  - [ ] 通知駅情報の保存
  - [ ] マイグレーション対応

## 実装ガイドライン
- 種別（各停/快速/特快等）に応じた停車駅の正確な把握
- ユーザーが直感的に理解できるプレビュー表示
- 通過駅は駅数にカウントしない
- 駅数は停車駅のみをカウント

## 完了条件（Definition of Done）
- [ ] 駅数で通知タイミングを設定できる
- [ ] 通知される駅が事前に確認できる
- [ ] 快速等の種別に対応している
- [ ] 正しいタイミングで通知される

## テスト方法
1. 各停/快速/特快でそれぞれテスト
2. 通過駅がある路線での動作確認
3. プレビューと実際の通知駅の一致確認
4. 異なる駅数設定での動作確認

## 依存関係
- チケット#022（基本実装）

## 成果物
- TrainTimetableAPIClient.swift
- StationCountNotificationView.swift
- StationPreviewView.swift
- StationCountCalculator.swift

## 備考
- 通過駅の扱いが重要なポイント
- ユーザビリティを考慮したプレビュー機能