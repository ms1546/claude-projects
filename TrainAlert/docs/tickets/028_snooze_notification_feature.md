# Ticket #028: スヌーズ機能（駅ごと通知）

## 概要
3駅前から一駅ごとに通知を行うスヌーズ機能を実装する。降車駅に近づくにつれて段階的に通知することで、より確実な寝過ごし防止を実現する。

## 優先度: Medium
## 見積もり: 8h
## ステータス: [ ] Not Started / [ ] In Progress / [ ] Completed

## タスク
### UI実装
- [ ] スヌーズ設定UI
  - [ ] スヌーズON/OFFトグル
  - [ ] 開始駅数の選択（1〜5駅前から選択可能）
  - [ ] 通知間隔の表示（各駅ごと）
  - [ ] プレビュー表示（どの駅で通知が来るか）

### データモデル実装
- [ ] Core Dataモデル拡張
  - [ ] isSnoozeEnabledフィールド追加
  - [ ] snoozeStartStationsフィールド追加（何駅前から開始）
  - [ ] snoozeNotificationIdsフィールド追加（複数通知ID管理）
  - [ ] マイグレーション対応

### ビジネスロジック
- [ ] 駅数カウント機能
  - [ ] 現在地から降車駅までの残り駅数計算
  - [ ] 各駅通過の検知ロジック
  - [ ] 駅数に応じた通知トリガー
- [ ] スヌーズ通知管理
  - [ ] 複数通知のスケジューリング
  - [ ] 各駅での通知内容生成
  - [ ] 通知IDの一元管理

### 通知実装
- [ ] 段階的通知メッセージ
  - [ ] 「あと3駅で到着です」
  - [ ] 「あと2駅で到着です！準備を始めましょう」
  - [ ] 「次の駅で降車です！お忘れ物にご注意ください」
  - [ ] キャラクタースタイルの適用
- [ ] 通知の音量/バイブレーション調整
  - [ ] 駅数に応じた緊急度の変化
  - [ ] 最終駅では強い通知

## 実装ガイドライン
- 駅数は正確にカウントできる路線のみ対応
- 通知が多すぎてうるさくならないよう配慮
- キャンセル可能な設計
- バッテリー消費に配慮

## 完了条件（Definition of Done）
- [ ] スヌーズ機能をON/OFFできる
- [ ] 指定した駅数前から通知が始まる
- [ ] 各駅で適切な通知が表示される
- [ ] 通知をタップすると詳細が確認できる

## テスト方法
1. 3駅前からのスヌーズ設定
2. 各駅での通知確認
3. 通知内容の段階的変化を確認
4. 最終駅での強調通知を確認

## 依存関係
- チケット#023（駅数ベース通知）
- チケット#025（遅延対応）※駅数カウントの正確性

## 成果物
- SnoozeSettingsView.swift
- SnoozeNotificationManager.swift
- Alert+SnoozeExtension.swift
- StationCountTracker.swift

## 備考
- 将来的には音声通知も検討
- Apple Watchとの連携も考慮
