# Ticket #026: 乗り換え対応機能

## 概要
経路検索機能を拡張し、複数路線を跨ぐ乗り換えルートの検索とアラート設定を可能にする。

## 優先度: High
## 見積もり: 24h
## ステータス: [ ] Not Started / [x] In Progress / [ ] Completed

## タスク
### 経路検索の拡張
- [x] 現状の経路検索機能の分析
  - [x] 単一路線内のみ対応を確認
  - [x] ODPT APIの制限を確認
- [ ] 駅間接続データの実装
  - [ ] 乗り換え可能駅のマッピング
  - [ ] 路線間接続情報の管理
  - [ ] 徒歩乗り換え情報の追加
- [ ] 経路探索アルゴリズムの実装
  - [ ] ダイクストラ法またはA*アルゴリズムの実装
  - [ ] 乗り換え時間の考慮
  - [ ] 複数経路候補の生成

### データモデル実装
- [x] RouteSearchResultの複数sections対応（既存）
- [ ] 乗り換え駅情報の拡張
  - [ ] 乗り換え時間の追加
  - [ ] プラットフォーム情報
  - [ ] 徒歩移動の考慮
- [ ] 時刻表データの統合
  - [ ] 複数路線の時刻表結合
  - [ ] 乗り換え可能時刻の計算

### API実装
- [ ] 複数路線の時刻表取得
  - [ ] 並列API呼び出し
  - [ ] データのキャッシング
  - [ ] エラーハンドリング
- [ ] 乗り換え駅の特定
  - [ ] 駅名の完全一致/部分一致
  - [ ] 路線別駅IDのマッピング

### UI更新
- [ ] RouteSearchViewの拡張
  - [ ] 乗り換えルートの表示
  - [ ] 各区間の詳細表示
  - [ ] 乗り換え時間の表示
- [ ] TimetableAlertSetupViewの対応
  - [x] 乗り換え駅での通知設定（削除済み）
  - [ ] 複数区間を考慮した通知設定

### ビジネスロジック
- [ ] 最適経路の選定
  - [ ] 所要時間優先
  - [ ] 乗り換え回数優先
  - [ ] 到着時刻の正確性優先
- [ ] 通知タイミングの計算
  - [ ] 各区間での通知
  - [ ] 乗り換え駅での通知
  - [ ] 最終到着駅での通知

## 実装ガイドライン
- 初期版は主要な乗り換え駅に対応
- 東京都内の主要路線を優先
- 乗り換え時間は固定値（3-5分）で開始
- 既存の経路検索UIを活用

## 完了条件（Definition of Done）
- [ ] 経路検索で複数路線を跨ぐルートが表示される
- [ ] transferCountが正しく計算される
- [ ] 各区間（sections）が正しく生成される
- [ ] 乗り換えルートでアラート設定ができる
- [ ] 乗り換え駅での通知が設定できる

## テスト方法
1. 異なる路線の駅間で経路検索
2. 乗り換えありルートの表示確認
3. アラート設定の動作確認
4. 通知タイミングの確認

## 依存関係
- チケット#018（時刻表統合）- 完了済み
- チケット#004（位置情報サービス）- 完了済み

## 成果物
- StationConnectionManager.swift（新規）
- RouteSearchAlgorithm.swift（新規）
- RouteSearchViewModel.swift（更新）
- ODPTAPIClient.swift（更新）

## 備考
- ODPT APIの制限により、独自の経路探索実装が必要
- 初期版は基本的な乗り換えパターンのみ対応
- 将来的にはより高度な経路探索アルゴリズムに拡張可能
