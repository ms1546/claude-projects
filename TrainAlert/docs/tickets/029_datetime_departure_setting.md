# Ticket #029: 出発日時の詳細設定機能

## 概要
経路設定で出発時刻を日時単位（日付＋時刻）で設定できる機能を実装する。翌日の電車や特定の日付の電車を検索・設定可能にする。

## 優先度: Medium
## 見積もり: 6h
## ステータス: [ ] Not Started / [ ] In Progress / [x] Completed

## 実装完了日
2025-08-21

## 実装の詳細
- DateTimePickerViewを新規作成し、日付と時刻を選択できる専用UIを実装
- 「今日」「明日」「明後日」のクイック選択ボタンを追加
- CalendarHelperを作成し、曜日・祝日判定とODPTカレンダーIDのマッピングを実装
- DateFormatterの拡張を作成し、相対的な日時表示に対応
- RouteSearchViewModelを更新し、選択された日付に応じたダイヤを自動選択

## タスク
### UI実装
- [x] 日時選択UI
  - [x] 日付ピッカーの追加
  - [x] 時刻ピッカーの改修（既存）
  - [x] 「今日」「明日」クイック選択ボタン
  - [x] カレンダー表示オプション
- [x] 選択した日時の表示
  - [x] フォーマット例：「12月25日(月) 15:30」
  - [x] 相対表示オプション（例：「明日 15:30」）
  - [x] 祝日/週末の色分け表示

### データモデル実装
- [x] RouteSearchのDate型対応
  - [x] departureDateフィールドの追加（既存のdepartureTimeを使用）
  - [x] 既存のdepartureTimeとの互換性維持
  - [x] タイムゾーン対応（JST固定）
- [ ] 保存データの拡張
  - [ ] お気に入り経路への日付情報追加
  - [ ] 履歴への完全な日時情報保存

### ビジネスロジック
- [x] 日付を考慮した時刻表検索
  - [x] 曜日に応じたダイヤ切り替え
  - [x] 土日祝日ダイヤの自動判定
  - [ ] 深夜をまたぐ電車の処理
- [x] 過去日時の制限
  - [x] 過去の日時は選択不可
  - [ ] 現在時刻より前の時刻警告
  - [ ] 自動的に次の日に切り替え

### API連携
- [x] ODPT API対応
  - [x] カレンダー情報の活用
  - [ ] 特別ダイヤの考慮
  - [ ] 年末年始ダイヤ対応

## 実装ガイドライン
- 既存の時刻のみ設定との互換性を保つ
- デフォルトは現在日時
- 未来の日付は最大1ヶ月先まで
- 祝日データはiOSのカレンダーAPIを使用

## 完了条件（Definition of Done）
- [ ] 日付と時刻を選択できる
- [ ] 選択した日時で正しい時刻表が検索される
- [ ] 土日祝日のダイヤが適切に選択される
- [ ] UIが直感的で使いやすい

## テスト方法
1. 当日の時刻設定
2. 翌日の時刻設定
3. 週末/祝日の時刻設定
4. 深夜0時をまたぐ設定

## 依存関係
- チケット#018（時刻表統合）
- チケット#025（遅延対応）※将来的な連携

## 成果物
- DateTimePickerView.swift
- RouteSearchViewModel+DateTime.swift
- CalendarHelper.swift
- DateFormatter+Extension.swift

## 備考
- 祝日判定は日本の祝日のみ対応
- 将来的には定期的な予約機能へ発展可能
